<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJMSFCL"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
<script src="https://gitcdn.link/repo/BlitzMedia/ZOOStock/master/ZOOStock.megamenu.js"></script>
<script src="https://unpkg.com/scrollreveal/dist/scrollreveal.min.js"></script>

<script>
const body = document.body;
const checkHomepage = () => body.classList.contains('homepage');
const checkProducts = () => body.classList.contains('collection-type-blog');
const checkList     = () => body.classList.contains('view-list');
const checkItem     = () => body.classList.contains('view-item');

// interval passed to reveal
window.sr = ScrollReveal({
  mobile: false,
  viewFactor: 0.1,
  //reset: true,
  distance: '10px'
});

// INIT
function initBlitz() {
  removeOverlay();
  initGalButtons()
  initVid();
  animater();
  setProductQuote();
  initProductNav();
  setCatNav();
  //destroyColorParallaxers();
  //addOverlay();
  //setParallax();
  console.log('⚡️');

}

// Init! ⚡️
window.Squarespace.onInitialize(Y, () => initBlitz());

function initGalButtons() {
  var galButtons = document.querySelectorAll('.Index-gallery-item-content-body a')
  galButtons.forEach(el => turnToButton(el))
}

function initVid() {
  window.vid = document.querySelector('#zoostock-nav .sqs-video-icon');
}

// Other functions
function animater() {
  sr.reveal(document.querySelectorAll('.homepage [id*="anim"] .Index-page-content'), {
    distance: '0px'
  });
  // Secuential anims
  sr.reveal(document.querySelectorAll('.sqs-col-3'), { viewFactor: 0.3 }, 50);
  sr.reveal('.sqs-gallery-design-grid-slide', { duration: 500 }, 75);
  sr.reveal('.Index-gallery-item-inner', { duration: 500, opacity: 0.6 }, 75);
  // Multiple Anims
  sr.reveal(document.querySelectorAll('#networking-accesories-components-home-red .spacer-block + .row'));
  sr.reveal(document.querySelectorAll('.homepage .image-card'), { origin: 'left' });
}

// Michael's product nav
function buildProductNav(pathname, items) {
    var product_nav = Y.Node.create('<nav style="margin:0 0 5px 0;line-height:1.4" class="ProductItem-nav"><div class="ProductItem-nav-breadcrumb"></div><div class="ProductItem-nav-pagination"></div></nav>');
    if (pathname && pathname.length) {
        var separator = '<span class="ProductItem-nav-breadcrumb-separator"></span>';
        var full_path = '/';
        pathname.forEach(function(frag, i) {
            full_path += frag + '/';
            var sep = i < pathname.length - 1 ? separator : '';
          	var disabled_class = !sep ? 'disabled':'';
            product_nav.one('.ProductItem-nav-breadcrumb').append('<a href="' + full_path + '" class="ProductItem-nav-breadcrumb-link '+disabled_class+'">' + frag + '</a>' + sep);
        })
    }
    if (items && items.length == 3) {
        var items_template = '<a href="/' + pathname[0] + items[1].fullUrl + '" class="ProductItem-nav-pagination-link ProductItem-nav-pagination-link--prev">' +
            '<span class="ProductItem-nav-pagination-link-direction">Previous</span><span class="ProductItem-nav-pagination-link-title">' + items[1].title + '</span></a>' +
            '<span class="ProductItem-nav-pagination-separator ProductItem-nav-pagination-separator--hasPrev ProductItem-nav-pagination-separator--hasNext"></span>' +
            '<a href="/' + pathname[0] + items[2].fullUrl + '" class="ProductItem-nav-pagination-link ProductItem-nav-pagination-link--next">' +
            '<span class="ProductItem-nav-pagination-link-direction">Next</span><span class="ProductItem-nav-pagination-link-title">' + items[2].title + '</span></a>';
        product_nav.one('.ProductItem-nav-pagination').append(items_template);
    }
    return product_nav;
};

function initProductNav() {
  if(Y.one('.Main--blog-item')) {//check if this is a created category or article page
  var pathname = location.pathname ? location.pathname.replace(/^\/|\/$/g, '').split('/') : false;
    var mainContent = Y.one('.Main-content');
      if(mainContent&&pathname.length>1){
        mainContent.prepend(buildProductNav(pathname))
      }
  }
}

// Parallax Intro
function setParallax() {
  if (!checkHomepage()) return;
  addOverlay();
  const parallax = document.getElementById('parallaxer');
  const observer = new MutationObserver((m) => { hideOverlay();});
  observer.observe(parallax, { attributes : true, attributeFilter : ['style'] });
  var parallaxer = new Parallax(parallax, { scalarX: 2 });
}

function addOverlay() {
  if (!document.body.classList.contains('homepage')) return;
  document.body.classList.add('setOverlay');
  document.getElementById('zoostock-overlay').classList.remove('hideOverlay')
}

function removeOverlay() {
  if(!checkHomepage()) return;

  var gallery = document.querySelector('#index-gallery');
  var overlay = document.getElementById('zoostock-overlay');

  if(!overlay) return;

  overlay.addEventListener('transitionend', function() {
    overlay.remove()
    if(observer) observer.disconnect();
  }, false);

  if(!gallery) return

  observer = new MutationObserver(mutation => {
    mutation.forEach(childMutation => {
      if(childMutation.attributeName === 'class') {
        overlay.classList.add('hideOverlay');
      }
    })
  }),
  config = { attributes: true };
  observer.observe(gallery, config);

  setTimeout(() => hideOverlay(), 500);
}

function setProductQuote() {

  const lightboxButton = document.querySelector('.Footer .lightbox-handle');

  if(checkItem()) {
    const getQuoteButton = document.querySelector('#block-getQuote .sqs-block-button-element');
    if(getQuoteButton) getQuoteButton.onclick = e => lightboxButton.click();
  }

  if(checkList()) {
    Y.one('body').delegate('click', e => {
      e.preventDefault();
      lightboxButton.click();
    }, '.quoter')
    document.querySelectorAll('.filtered .button-block a').forEach(el => {
      if(el.text === 'Get a Quote') el.onclick = e => {
        e.preventDefault();
        lightboxButton.click();
      }
    })
  }
}

function setCatNav() {
  if(!checkProducts() && !checkItem()) return;
  if(checkList()) return;
  const archives = document.querySelectorAll('.BlogItem .sqs-block-archive');
  if(!archives) return;
  const cat = document.querySelector('a.Blog-meta-item-category').textContent.trim();
  const title = document.querySelector('.BlogItem-title');
  const target = title.parentNode;

  archives.forEach(archive => {
    target.insertBefore(archive, title);
    archive.querySelectorAll('a').forEach(el => {
      if(el.textContent.trim() === cat) el.classList.add('active');
    })
  })
}

</script>

<script>
window.customFilterSettings = {
    'targets': [{
        container: '.collection-5af2eca01ae6cfb413544b61 #block-yui_3_17_2_1_1525886278502_3845, .collection-5af2eca01ae6cfb413544b61 #block-categorySummary, .collection-5b291a29575d1ff09437761d #block-yui_3_17_2_1_1529421639296_3852, .collection-5b29382e2b6a28bf939fb8d7 #block-yui_3_17_2_1_1529428379200_3830, .collection-5b293c2f758d46d3d609fd82 #block-yui_3_17_2_1_1529429054890_7723',
        items: '.summary-item',
        settings: {
          	performanceMode:true,
            showItemsCount: true, //hide items count
            position: 'left',
          	keepDropdownsOpen: false,
            requestAttrWithAjax: false,
          	mobilePanel:{
          		enabled: true
          	},
          	isotope: {
            	enabled: false,
              	columnWidth: '30%'
            },
            simpleFilter: {
                anim: true,
                show: {
                    effect: 'slideLeft',
                    transitionDuration: 400,
                    stagger: 100
                },
                hide: {
                    effect: 'slideRight',
                    transitionDuration: 300,
                    stagger: 60
                }
            },
            filter: {
              	category:false,
              	tag: false,
                items: [
                  {
                      name: 'Vendor',
                      multiple: true,
                      getAttr: 'categories'
                  },{
                    name: 'Form Factor',
                    multiple: true,
                    getAttr: function(el, data) {
                      //el is the real html node of item and data is json-data of this item (product)
                        var arr = [];
                        var variants = data.variants;
                        if (variants && variants.length) {
                          //now loop through all product variants and build array of sizes
                            arr = Y.Array.map(variants, function(variant) {
                                var formFactor = variant['Form Factor'] || '';
                                return formFactor;
                            })
                        }
                        return arr;
                    },
                },{
                    name: 'Data Rate',
                    multiple: true,
                    getAttr: function(el, data) {
                        var arr = [];
                        var variants = data.variants;
                        if (variants && variants.length) {
                            arr = Y.Array.map(variants, function(variant) {
                                var dataRate = variant['Data Rate'] || '';
                                return dataRate;
                            })
                        }
                        return arr;
                    },
                },{
                    name: 'Media Type',
                    multiple: true,
                    getAttr: function(el, data) {
                        var arr = [];
                        var variants = data.variants;
                        if (variants && variants.length) {
                            arr = Y.Array.map(variants, function(variant) {
                                var mediaType = variant['Media Type'] || '';
                                return mediaType;
                            })
                        }
                        return arr;
                    },
                }]
            },
            sort: {
                enabled: false,
                items: [{
                    name: 'Price',
                    order: 'asc|desc'
                }, ]
            },
            search: {
                 positionOrder: 100,
                 text: 'Search',
                 searchFunc: function(el) {
                     var result = '',
                         textContent = '',
                         classes = '';
                     el = el._node ? el._node : el;
                     textContent = el.textContent.trim();
                     classes = el.className;
                     result = textContent + ' ' + classes;
                     return result;
                 },
                 enabled: true
             }
        }
    }]
};
</script>
<script src="https://assets.squarewebsites.org/lazy-summaries/lazy-summaries.min.js"></script>
<script src="https://assets.squarewebsites.org/custom-filter/custom-filter.min.js"></script>
<script>
if (window.self !== window.top && window.top.document.querySelector('html.squarespace-damask')) {
    if (!window.top.document.getElementById('lazy-summaries-admin')) {
        window.top.Y.Get.js('https://assets.squarewebsites.org/lazy-summaries/lazy-summaries-admin.js', function (err, tx) {
            if (err) {
                Y.log('Error loading Lazy Summaries JS: ' + err[0].error, 'error');
                return;
            }
            tx && tx.nodes[0].setAttribute('id', 'lazy-summaries-admin');
        });
    }
}
</script>

<script>
(function(w,d,v2){
    w.chaport = { app_id : '5aa7e53bddd47f53f0a966db' };

    v2=w.chaport;v2._q=[];v2._l={};v2.q=function(){v2._q.push(arguments)};v2.on=function(e,fn){if(!v2._l[e])v2._l[e]=[];v2._l[e].push(fn)};var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://app.chaport.com/javascripts/insert.js';var ss=d.getElementsByTagName('script')[0];ss.parentNode.insertBefore(s,ss)})(window, document);
</script>
